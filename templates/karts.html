{% extends "base.html" %}
{% load nfsformat %}

{% block title %}
    KARTS
{% endblock %}


{% block body %}
    <div class="skip-first-stint">
        <form action="/skip-first-stint" method="post">
            {% csrf_token %}
            <span>Skip first stint from stats</span>
            &nbsp;&nbsp;&nbsp;
            <label><input onchange="this.form.submit();"
                          type="radio"
                          name="skip_first_stint"
                          value="0"
                          {% if not skip_first_stint %}checked="checked"{% endif %}>
                No</label>

            <label><input onchange="this.form.submit();"
                          type="radio"
                          name="skip_first_stint"
                          value="1"
                          {% if skip_first_stint %}checked="checked"{% endif %}>
                Yes</label>
        </form>
    </div>
    <div>
    Order by:
        <ul class="sorting-options">
            <li>{% if sorting != 'best_lap' %}<a href="{% url 'karts' %}">Best</a>{% else %}<b>Best</b>{% endif %}</li>
            <li>{% if sorting != 'avg_80' %}<a href="{% url 'karts' %}?sort=avg_80">Avg</a>{% else %}<b>Avg</b>{% endif %}</li>
            <li>{% if sorting != 'optimal' %}<a href="{% url 'karts' %}?sort=optimal">Optimal</a>{% else %}<b>Optimal</b>{% endif %}</li>
            <li>{% if sorting != 'best_sector_1' %}<a href="{% url 'karts' %}?sort=best_sector_1">S1</a>{% else %}<b>S1</b>{% endif %}</li>
            <li>{% if sorting != 'best_sector_2' %}<a href="{% url 'karts' %}?sort=best_sector_2">S2</a>{% else %}<b>S2</b>{% endif %}</li>

        </ul>
    </div>
    <table>
        <thead>
        <tr>
            <th style="width: 2em; "><i class="fa-solid fa-car-side"></i></th>
            <th class="pilot-name">Pilot</th>
            {% if sorting == 'optimal' %}
            <th>Optimal</th>
            {% else %}
            <th>Best</th>
            {% endif %}
            <th>Sectors</th>
            <th>Avg</th>
        </tr>

        </thead>
        {% for stint in stints %}
            {# TODO: move stints tables to the separate component! #}
            {# TODO: highlight column which is now sorted by #}
            <tr>
                <td style="width: 2em; vertical-align: middle">
                    <a class="kart-number" href="{% url 'kart-detail' stint.kart %}">
                        {{ stint.kart }}
                    </a>
                </td>
                <td class="pilot-name">{{ stint.pilot|split_pilot }}</td>
                 {% if sorting == 'optimal' %}
            <td style="font-weight: bold">
            {{ stint.best_theoretical|floatformat:3 }}
            </td>

            {% else %}
            <td {% if sorting == 'best_lap' %}style="font-weight: bold;"{% endif %}>{{ stint.best_lap|floatformat:3 }}</td>
            {% endif %}
                <td>
                    <span {% if sorting == 'best_sector_1' %}style="font-weight: bold;"{% endif %}>{{ stint.best_sector_1|floatformat:2 }}</span>
                    <br>
                    <span {% if sorting == 'best_sector_2' %}style="font-weight: bold;"{% endif %}>{{ stint.best_sector_2|floatformat:2 }}</span>
                </td>
                <td {% if sorting == 'avg_80' %}style="font-weight: bold;"{% endif %}>{{ stint.avg_80|floatformat:3 }}</td>
            </tr>
        {% endfor %}

    </table>

{% endblock %}